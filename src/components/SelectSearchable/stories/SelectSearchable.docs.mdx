import { Canvas, Meta, Story, Title, Description, Primary, Controls } from '@storybook/addon-docs/blocks';
import * as RootStories from './SelectSearchable.Root.stories';
import * as ErrorStories from './SelectSearchable.Error.stories';
import * as TriggerStories from './SelectSearchable.Trigger.stories';
import * as DropdownStories from './SelectSearchable.Dropdown.stories';
import * as OptionStories from './SelectSearchable.Option.stories';

<Meta of={RootStories} />

<a id="top" />
# SelectSearchable

A composable, searchable, and accessible select component that supports single and multiple
selection, custom triggers, and large option sets.

<Canvas of={RootStories.Playground} />

Jump to: [Root](#root), [Label](#label), [Error](#error), [Trigger](#trigger), [TriggerValue](#triggervalue), [Dropdown](#dropdown), [OptionList](#optionlist), [Option](#option), [OptionCategoryHeader](#optioncategoryheader), [OptionDivider](#optiondivider)

<a id="root" />
## SelectSearchable.Root

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.Root** is the top-level component that manages state, focus, and accessibility for the select.

<details>
  <summary>Click to expand details</summary>

  SelectSearchable renders a visually hidden native `<select>` element for form submission and native integration.

  ### Focus Management

  SelectSearchable contains two internal focusable elements:

  - **Trigger** – `role="button"` (displays the selected value and toggles the listbox)
  - **Search** – `role="combobox"` (used to filter and navigate options)

  If no `Search` subcomponent is composed, the `Trigger` assumes the `combobox` role instead.

  ### Labelling

  In most cases, you should use the `Label` and `Error` subcomponents. It automatically associates a visible label and error with both internal focusable elements.

  If you need manual control, you may provide ARIA attributes directly.

  The following attributes can be set on the **Root** and will be forwarded to internal focusable elements:

  - `aria-labelledby`
  - `aria-label`
  - `aria-describedby`
  - `aria-description`
  - `aria-errormessage`

  These attributes may also be provided directly on `Trigger` or `Search`.

  If attributes are provided in multiple places (Root + subcomponent), their values are merged (duplicates removed) before being applied.

  ### Validation

  When `aria-invalid` is set on the Root:

  - The invalid state is applied to the combobox element.
  - Any `Error` sub component or referenced `aria-errormessage` id is automatically included in `aria-describedby` so that error text is announced when either focusable element receives focus.

  ### Styling Invalid

  For styling invalid state, SelectSearchable exposes a `data-invalid` attribute on internal parts (e.g. Label / Trigger / Search / Dropdown / Error).  
  Prefer using `data-invalid` as a visual hook rather than styling based on `aria-invalid`, since `aria-invalid` is only applied to the combobox element.

</details>

<Controls of={RootStories.Playground} />


<a id="label" />
## SelectSearchable.Label

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.Label** renders a native `<label>` element and automatically associates it with the SelectSearchable control.

<details>
  <summary>Click to expand details</summary>

  The Label:

  - Automatically links to the internal control via `htmlFor`.
  - Provides an accessible name for both internal focusable elements (Trigger and Search).
  - Requires no manual `id` or `aria-labelledby` wiring.

  ### Controlled props (cannot be overridden):

  - `id`
  - `htmlFor`

  The `id` is generated by the Root and used internally to manage accessibility relationships.

  ### Accessibility

  When mounted, the Label registers itself with the Root so that:

  - It is included in `aria-labelledby` for internal focusable elements.
  - Manual `aria-labelledby` values provided on Root or subcomponents are merged automatically.

  ### Styling

  Exposes `data-part='label'` and `data-invalid` for easy custom styling.

</details>


<a id="error" />
## SelectSearchable.Error

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.Error** renders an error message associated with the SelectSearchable control.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<p>` element and automatically links itself to the control for accessibility.

  ### Controlled props (cannot be overridden):

  - `id`

  The `id` is generated by the Root and used to associate the error message with the control.

  ### Accessibility

  When mounted:

  - The error message `id` is merged into `aria-describedby` when `aria-invalid` is true.
  - Screen readers can announce the error message when the control receives focus.

  ### Visibility

  If `hideWhenValid` is `true`, the component will not render when the control is valid.

  If preferred, you may instead conditionally render the component yourself based on validation state.

  ### Styling

  Exposes `data-part='error'` and `data-invalid` for easy custom styling.

</details>

<Controls of={ErrorStories.Default} />


<a id="trigger" />
## SelectSearchable.Trigger

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.Trigger** renders the interactive control that opens and closes the dropdown.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<button>` element and forwards all standard `<button>` attributes **except** those managed by the Root context.
  When no `Search` subcomponent is present, the Trigger assumes the `combobox` role and handles keyboard navigation directly.

  ### Controlled props (cannot be overridden):

  - `id`
  - `type`
  - `disabled`
  - `role`
  - `aria-haspopup`
  - `aria-controls`
  - `aria-expanded`
  - `aria-activedescendant`
  - `aria-invalid`

  The Trigger’s `id` is stable and derived from the Root `id`, using the suffix `--control`.

  ### Children

  `children` may be either:
  - A `ReactNode`, or
  - A render function receiving:
    - `selectedValues: string[]`
    - `selectedLabels: string[]`
    - `isOpen: boolean`
    - `multiple: boolean`

  `selectedValues` contains the currently selected option values.
  `selectedLabels` contains the corresponding resolved labels from the registry.

  ### Styling

  Exposes:
  - `data-part='trigger'`
  - `data-state='open | closed'`
  - `data-invalid`

  for easy custom styling.

</details>

<Controls of={TriggerStories.Default} />


<a id="triggervalue" />
## SelectSearchable.TriggerValue

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.TriggerValue** renders the currently selected value (or a placeholder) inside the Trigger.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<span>` element and displays the current selection.

  ### Behavior

  - When no value is selected, it renders `placeholder` (default: "Select…").
  - In non-multiple mode, it renders the selected option label.
  - In multiple mode, it renders a summary (e.g. "3 selected").

  ### Controlled props (cannot be overridden):

  - `children`

  The displayed content is derived from the current selection and cannot be manually provided.

  ### Styling

  Exposes `data-part='value'` for easy custom styling.

</details>


<a id="dropdown" />
## SelectSearchable.Dropdown

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.Dropdown** renders the floating panel that contains the Search and OptionList sub components.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<div>` and renders it in a portal (to `document.body`) so it can float above surrounding layout.

  ### Behavior

  - Positions itself relative to the Trigger and automatically flips **up** or **down** based on available viewport space.
  - Clamps its maximum height to the viewport (and becomes scrollable when needed).
  - Closes when the user scrolls outside of the dropdown.

  ### Controlled props (cannot be overridden):

  - `ref`
  - `aria-hidden`

  The dropdown `ref` is managed by the Root for focus and interaction behavior.

  ### Styling

  Exposes `data-part='dropdown'` and the following attributes for easy custom styling:

  - `data-state='open | closed'`
  - `data-placement='down | up'`
  - `data-owner='{triggerId}'`
  - `data-invalid`

</details>

<Controls of={DropdownStories.Default} />


<a id="search" />
## SelectSearchable.Search

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.Search** renders the combobox input used to filter and navigate options.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<input type="text">` element and is responsible for listbox navigation and active-descendant behavior.

  ### Controlled props (cannot be overridden):

  - `role`
  - `value`
  - `defaultValue`
  - `autoFocus`
  - `aria-invalid`

  The Search input is controlled by the Root context and manages its own combobox semantics.

  ### Behavior

  - Automatically focuses when the dropdown opens.
  - Updates the option filter as you type.
  - Uses `aria-activedescendant` to track the active option while focus remains in the input.
  - Keyboard navigation is supported via the standard combobox + listbox pattern.

  ### Accessibility

  - Uses `role="combobox"` with `aria-controls` pointing to the listbox.
  - Labels and descriptions provided on Root and/or Search are merged before being applied.
  - When invalid, the error message id is merged into `aria-describedby` so it can be announced on focus.

  ### Styling

  Exposes `data-part='search'` and `data-invalid` for easy custom styling.

</details>


<a id="optionlist" />
## SelectSearchable.OptionList

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.OptionList** renders the listbox container that holds selectable options.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<ul>` element and applies listbox semantics.

  ### Controlled props (cannot be overridden):

  - `id`
  - `role`
  - `ref`
  - `aria-hidden`
  - `aria-multiselectable`

  These attributes are managed by the Root context to ensure proper listbox behavior.

  ### Accessibility

  - Uses `role="listbox"`.
  - The `id` is generated by the Root and referenced by the combobox via `aria-controls`.
  - When the control is closed or disabled, `aria-hidden` is applied.
  - In multiple mode, `aria-multiselectable="true"` is set automatically.

  ### Styling

  Exposes `data-part='list'` for easy custom styling.

</details>


<a id="option" />
## SelectSearchable.Option

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.Option** renders a selectable item within the OptionList.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<li>` element and automatically participates in selection, keyboard navigation, ordering, and filtering within the `SelectSearchableOptionList`.

  ### Required props

  - `itemId: string` – A stable, unique identifier for this option within the list. Used internally for registration and ARIA linking. This is **not** the DOM `id`.
  - `value: string` – The value committed to the control when this option is selected.

  ### Controlled props (cannot be overridden)

  - `id`
  - `role`
  - `aria-selected`
  - `aria-disabled`
  - `aria-hidden`
  - `hidden`
  - `ref`

  The DOM `id` is generated automatically from the listbox and `itemId` to ensure uniqueness and correct `aria-activedescendant` behavior.

  ### Accessibility

  - Uses `role="option"` within the `listbox`.
  - Applies `aria-selected` when selected.
  - Applies `aria-disabled` when disabled.
  - Applies `aria-hidden` and `hidden` when filtered out.
  - Active state is managed via `aria-activedescendant` on the combobox.

  No manual ARIA wiring is required.

  ### Behavior

  - Clicking an option commits its value.
  - In `multiple` mode, selection toggles.
  - Mouse interactions do not steal focus from the Trigger/Search.
  - Automatically participates in filtering and keyboard navigation.

  ### Styling

  Exposes:

  - `data-part='option'`
  - `data-selected`
  - `data-active`
  - `data-disabled`
  - `data-hidden`

  for easy custom styling.

</details>

<Controls of={OptionStories.Default} />


<a id="optioncategoryheader" />
## SelectSearchable.OptionCategoryHeader

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.OptionCategoryHeader** renders a non-interactive category header row within the OptionList.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<li>` element and is intended for visual grouping of related options.

  ### Controlled props (cannot be overridden)

  - `role`
  - `aria-hidden`
  - `hidden`

  The header is presentation-only and is not selectable.

  ### Accessibility

  - Uses `role="presentation"` so it does not participate as an option in listbox semantics.
  - It is excluded from selection, active-descendant navigation, and option registration.

  No manual ARIA wiring is required.

  ### Behavior

  - Automatically hides when no visible options remain in its section after filtering.
  - Serves as a visual grouping primitive for flat OptionList content.

  ### Styling

  Exposes `data-part='option-category-header'` for easy custom styling.

</details>


<a id="optiondivider" />
## SelectSearchable.OptionDivider

<div className="topLink">
  [Back to top](#top)
</div>

**SelectSearchable.OptionDivider** renders a non-interactive separator row within the OptionList.

<details>
  <summary>Click to expand details</summary>

  It wraps a native `<li>` element and is intended to visually separate blocks of options.

  ### Controlled props (cannot be overridden)

  - `role`
  - `aria-hidden`
  - `hidden`

  The divider is presentation-only and is not selectable.

  ### Accessibility

  - Uses `role="separator"` with `aria-orientation="horizontal"`.
  - It is excluded from selection, active-descendant navigation, and option registration.

  No manual ARIA wiring is required.

  ### Behavior

  - Automatically hides when it does not separate two visible options (for example: at list edges, stacked with other dividers, or adjacent to headers).
  - If a divider is placed directly before a header, it will follow the visibility of that header.
  - Remains a purely visual structure element while options retain listbox semantics.

  ### Styling

  Exposes `data-part='option-divider'` for easy custom styling.

</details>
